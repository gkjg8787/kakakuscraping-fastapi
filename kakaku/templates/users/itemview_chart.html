{% extends "shared/layout.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', path='/css/style.css') }}" type="text/css">
<title>価格グラフ</title>
{% endblock %}

{% block body %}
<h1>価格グラフ</h1>
{% if is_predict %}
<h3>予測設定</h3>
<div class="predict_config_list">
  <form method="{{ date_range_filter.form.method }}" action="{{ date_range_filter.form.action }}"
    id="{{ date_range_form }}">
    <div class="date_range_box config_box">
      {{ date_range_filter.range_input.title }} : <input type="date"
        name="{{ date_range_filter.range_input.lower.input_name }}"
        min="{{ date_range_filter.range_input.lower.min_value }}"
        max="{{ date_range_filter.range_input.lower.max_value }}"
        value="{{ date_range_filter.range_input.lower.value }}">
      　～　<input type="date" name="{{ date_range_filter.range_input.upper.input_name }}"
        min="{{ date_range_filter.range_input.upper.min_value }}"
        max="{{ date_range_filter.range_input.upper.max_value }}"
        value="{{ date_range_filter.range_input.upper.value }}">
    </div>
    <div class="predict_period_box config_box">
      予測する日数 : <input type="number" step="1" name="{{ PERIOD_NAME }}" value="{{ predict_length }}">
    </div>
    <button type="submit">予測する</button>
    {% for k, v in fquery.items() %}
    {% if k != date_range_filter.range_input.lower.input_name and k != date_range_filter.range_input.upper.input_name
    and k != PERIOD_NAME and v != "" %}
    <input type="hidden" name="{{ k }}" value="{{ v }}">
    {% endif %}
    {% endfor %}
  </form>
</div>
{% endif %}
<canvas id="myLineChart"></canvas>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.js"></script>
<script>
  var ctx = document.getElementById("myLineChart");
  var myLineChart = new Chart(ctx, {
    type: 'line',
    data: {
      datasets: [
        {
          label: '中古価格',
          data: [
            {% for row in used_list %}
                  { x: "{{ row['x'] }}", y: "{{ row['y'] }}" },
        {% endfor %}  
                ],
  borderColor: "rgba(255,0,0,1)",
    backgroundColor: "rgba(0,0,0,0)",
      lineTension: 0,
              },
  {% if new_list %}
  {
    label: '新品価格',
      data: [
        {% for row in new_list %}
  { x: "{{ row['x'] }}", y: "{{ row['y'] }}" },
  {% endfor %}  
              ],
  borderColor: "rgba(0,255,0,1)",
    backgroundColor: "rgba(0,0,0,0)",
      lineTension: 0,
          },
  {% endif %}
  {% if used_predict %}
  {
    label: '中古予想価格',
      data: [
        {% for row in used_predict %}
  { x: "{{ row['x'] }}", y: "{{ row['y'] }}" },
  {% endfor %}
            ],
  borderColor: "rgba(0,0,255,1)",
    backgroundColor: "rgba(0,0,0,0)",
      lineTension: 0,
          },
  {% endif %}
        ],
      },
  options: {
    title: {
      display: true,
        },
    scales: {
      xAxes: [{
        type: 'time',
        time: {
          unit: 'month'
        }
      }
      ]
    },
    animation: false,
      tooltips: {
      mode: 'nearest',
        intersect: false,
        },
  }
    });
</script>
<p><a href="{{ url_for('read_users_items_view',) }}?{{ ITEMID_Q_NAME }}={{ item_id }}" class="plain-link">アイテム詳細へ戻る</a>
</p>
{% endblock %}