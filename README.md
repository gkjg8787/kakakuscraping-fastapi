# kakakuscraping-fastapi

## 概要

- 特定のサイトページをスクレイピングして価格情報をデータベースに保存します。<br>
  対象サイト
  - 駿河屋
  - ブックオフ公式オンラインストア
  - ネットオフ
- アイテムやグループとしてまとめて一覧で管理することができます。
- 複数のアイテムを送料込みの価格でどこの店で購入すると安いかを計算しサポートします。
- 詳細は[Wiki](https://github.com/gkjg8787/kakakuscraping-fastapi/wiki)を参照してください。

### 対応するデータベース

[対応するデータベース](https://github.com/gkjg8787/kakakuscraping-fastapi/wiki/Database)を参照してください。

### docker で動かす

0. 前提：docker をインストール済み
1. ダウンロードしたディレクトリ内の Dockerfile がある場所で以下のコマンドを実行しイメージを作成します。<br>
   `docker build -t kakaku-build:test .`
2. 次のコマンドでイメージを実行<br>
   `docker run --init -p 8000:8000 --name kakaku -it kakaku-build:test`
3. 実行できたら URL にアクセスしてください。<br>
   `http://127.0.0.1:8000`

### 使い方

- #### URL を追加<br>
  - 検索して追加<br>
    操作メニューの**アイテムを探して追加**から外部サイトを検索して追加することができます。
  - 直接 URL を指定して追加<br>
    操作メニューの**アイテム追加**から URL を指定して追加することができます。※対象サイトの商品ページのみ
- #### URL を更新<br>
  操作メニューの**一括情報取得**もしくはアイテム毎の情報取得から登録した URL の情報を取得します。
  URL の更新にはバックサーバを起動する必要があります。
  - バックサーバ<br>
    操作メニューの**管理画面**から移動して、起動する必要があります。稼働中で URL の更新ができます。
- #### 価格計算<br>
  登録したアイテムを選択し、送料条件を入力することで送料込みの最安値の組み合わせを出力することができます。<br>
  **_※常に最安値がでるとは限らないので参考程度にして下さい_**<br>
  操作メニューの**アイテムの価格計算**からできます。
- #### 分析機能<br>
  何日分かログがあれば簡易な分析機能を使うことができます。登録したアイテムを分析し、傾向を出力します。<br>
  操作メニューの**アイテムの分析**からできます。
- #### 注意<br>
  - URL の追加をしたら更新しないと反映されません。
  - 対象サイトがエラーを返した場合は取得に失敗します。
  - 対象サイトの HTML 構造が変わると取得できません。
  - 対象サイトのドメインが変わった際は既存のものは更新されません。URL を削除し、再登録する必要があります。<br>
    tool を使って変更することができます。[登録 URL 変更](https://github.com/gkjg8787/kakakuscraping-fastapi/wiki/Tool#%E7%99%BB%E9%8C%B2url%E5%A4%89%E6%9B%B4)を参照してください。
  - 1 つのアイテムに沢山の URL を登録すると価格計算が終わらないかもしれません。
