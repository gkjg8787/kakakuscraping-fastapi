{% extends "layout.html" %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', path='/css/style.css') }}" type="text/css">
    <title>買取URL一覧</title>
{% endblock %}

{% block body %}
    <h1>買取URL一覧</h1>
    <p><a href="{{ url_for('read_users') }}" class="plain-link">アイテム一覧へ戻る</a></p>
    <h3>フィルタ</h3>
    <div>
        <p>
        {%- with ITEMACT_NAME = ITEMACT_NAME, actstslist = actstslist, fquery = fquery %}
        {%- include "users/item_act_filter.html" %}
        {%- endwith %}
        </p>
        <p>
        {%- with ITEMSORT_NAME = SORT_NAME, itemSortList = itemsortlist, fquery = fquery %}
        {%- include "users/item_sort_filter.html" %}
        {%- endwith %}
        </p>
    </div>
    <p>
        件数
        {{ res_length }}件
    </p>
    <table class="purchase_list_table">
        <tr>
            <th>item_id</th>
            <th>アイテム名</th>
            <th>url_id</th>
            <th>買取URL</th>
            <th>アイテムURL</th>
            <th>ACTIVE状態</th>
            <th>登録日</th>
        </tr>
        {%- for row in res %}
        <tr>
            {%- if row.urls_num > 0 %}
            <td rowspan="{{ row.urls_num }}">{{ row.item_id }}</td>
            <td rowspan="{{ row.urls_num }}">{{ row.name }}</td>
            {% set itemurl = row.get_url_list()[0] %}
            <td>{{ itemurl.url_id }}</td>
            <td>
                {%- with url = itemurl.purchase_url %}
                {%- include "url_link.html" %}
                {%- endwith %}
            </td>
            <td> 
                {%- with url = itemurl.item_url %}
                {%- include "url_link.html" %}
                {%- endwith %}
            </td>
            <td>{{ itemurl.act_status }}</td>
            {%- else %}
            <td>{{ row.item_id }}</td>
            <td>{{ row.name }}</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            <td>None</td>
            {%- endif %}
            {%- if row.urls_num > 0 %}
            <td rowspan="{{ row.urls_num }}">{{ row["created_at"] }}</td>
            <td rowspan="{{ row.urls_num }}" class="noborder nobreak">
                <a href="{{ url_for('read_users_items_view') }}?{{ ITEMID_Q_NAME }}={{ row['item_id'] }}"
                 target="_blank" rel="noopener noreferrer" class="like_button_link">アイテム詳細</a>
            </td>
            {%- else %}
            <td>{{ row["created_at"] }}</td>
            <td class="noborder nobreak">
                <a href="{{ url_for('read_users_items_view') }}?{{ ITEMID_Q_NAME }}={{ row['item_id'] }}"
                 target="_blank" rel="noopener noreferrer" class="like_button_link">アイテム詳細</a>
            </td>
            {%- endif -%}
        </tr>
        {%- for itemurl in row.get_url_list()[1:] %}
        <tr>
            <td>{{ itemurl.url_id }}</td>
            <td>
                {%- with url = itemurl.purchase_url %}
                {%- include "url_link.html" %}
                {%- endwith %}
            </td>
            <td> 
                {%- with url = itemurl.item_url %}
                {%- include "url_link.html" %}
                {%- endwith %}
            </td>
            <td>{{ itemurl.act_status }}</td>
        </tr>
        {%- endfor %}
        {%- endfor %}
    </table>
    <p><a href="{{ url_for('read_users') }}" class="plain-link">アイテム一覧へ戻る</a></p>
{% endblock %}
